Система управления - простой регулятор температуры

В процессе варки пива есть этап "Затирание сусла" (Mashing http://en.wikipedia.org/wiki/Mashing).
Во время этого этапа нужно очень точно поддерживать температуру затора (это все содержимое заторного чана).

Говоря доступным языком все что в среднем баке нашей установки должно иметь температуру, скажем, 65 градусов. Причем чем точнее тем лучше - плюс-минус полградуса. А в баке по-сути, каша. Для того чтобы там все равномерно нагреть мы используем рециркуляцию - насос отбирает воду/сусло снизу и выпускает наверх. В нижнем выходном патрубке установлен термодатчик - он измеряет температуру перекачиваемой наверх жидкости. Ее-то мы и будем регулировать. 

В нашей системе управления есть программируемый контроллер. Его мы и будем использовать для регулирования температуры. Для подобных задач есть два метода решения. 

Первый - включать нагреватель если температура меньше заданной, и выключать если больше. Примерно так работают бойлеры и холодильники. Проблема этого метода в том, что достичь точной температуры не удастся - ошибка будет в несколько градусов.

Для точного регулирования используется алгоритм Пропорционального-интегрально-дифференциального (ПИД) регулятора. Этот алгоритм учитывает динамику системы и позволит нам очень точно регулировать температуру. Если на пальцах, то этот алгоритм знает как быстро нагревает наша горелка заторный чан, как сильно температура будет расти после выключения горелки, и тому подобное.

Откуда он это знает? Эти параметры можно задать вручную, но в большинстве контроллеров используются "обучаемые" алгоритмы - это когда контроллер сам измеряет нужные ему параметры в процессе работы с системой. В нашем контроллере процесс обучения оформлен отдельно - то есть, его нужно явно запустить. 

Вот как выглядит кусок программы контроллера для PID регулятора:

PID.png

Выглядит страшновато, но на самом деле там все довольно просто. Регулировка недоступна пока PID не настроится. А настройка запускается специальной кнопкой Autotune на экране настроек.

Теперь надо запрограммировать управление нагревом. У PID регулятора на выходе аналоговый сигнал - от 0 до 1000. Ну то есть, если греть надо вполсилы, то там будет 500, а если на треть - то 333, и так далее. А газ у нас либо включен, либо выключен. Горелки эти не могут вполсилы гореть. Как же быть? 

Тут нам поможет широтно-импульсная модуляция - ШИМ http://ru.wikipedia.org/wiki/%D0%A8%D0%B8%D1%80%D0%BE%D1%82%D0%BD%D0%BE-%D0%B8%D0%BC%D0%BF%D1%83%D0%BB%D1%8C%D1%81%D0%BD%D0%B0%D1%8F_%D0%BC%D0%BE%D0%B4%D1%83%D0%BB%D1%8F%D1%86%D0%B8%D1%8F (по-английски PWM http://en.wikipedia.org/wiki/Pulse-width_modulation). Если коротко, то это значит что мы будем газ включать-выключать. Вот так выглядит этот блок в программе контроллера:

PWM.png

Cycle Time - 6000 - это 15 сек. Control - это наш управляющий сигнал от 0 до 1000. А на выходе - уже двоичный сигнал (включено/выключено), управляющий клапаном. Цикл 15 сек - это значит что в течение каждых 15 сек клапан будет включен ровно ту часть из них, которая задается входным сигналом. 0 - значит все время выключен, 1000 - все время включен. 333 - 5 сек включен, 10 выключен.
Чем время цикла меньше, тем меньше будут заметны пульсации, но зажигать горелку каждую секунду просто не получится, да и клапан быстро сдохнет. При слишком длинном цикле начнет пульсировать выходная температура. Я пока поставил 15 сек - это 4 включения в минуту. Не так уж много. Потом опытным путем подберем оптимальный период.

Загружаю программу в контроллер, запускаю. Жму Autotune - газовый клапан щелкает. Уже хорошо. Теперь сделаем тестовый запуск автонастройки. Налили воды в заторный чан (средний бак), запустили насос, зажгли запальник, включаем автонастройку. Контроллер зажег газ и начал нагревать до установленной температуры в 65 градусов. Ждать не хотелось, и установку я поменял установку на 35 градусов. Контроллыер добил до 36 и выключился. Для автонастройки ему нужно 3 цикла нагревания-охлаждения сделать. Сидим ждем когда остынет ниже 35 градусов. Ждем полчаса - никак не хочет охлаждаться. Под чаном еще и запальник горит и немного подогревает его. Что делать? Решили температуру увеличить - разница будет больше и охлаждаться лучше будет. Поставили 65 градусов. Горелка сразу зажглась, нагрела воду до 66, выключилась. Охлаждение пошло побыстрее, поэтому за час мы три цикла прогнали. Теперь доступен режим регулировки.

В режиме регулировки я сразу выставил темературу 70 градусов (а заторник уже был нагрет до 65). Регулятор заработал и начал греть. Но почему-то греть стал не сильно. Управляющий сигнал был в районе 200-300, то есть, горелка работала на 20-30%, то есть, 4-5 сек. из 15-ти. На мой вкус медленновато. Инерционность регулятор знает. Нагреть на 5 градусов можно гораздо быстрее, за полтора остановиться и там уже подгонять поточнее. Что-то идет не так, но что - пока непонятно. Ладно, разберемся. А пока посмотритет видео как это выглядит:

http://youtu.be/LMN_Qo9ZE6k
